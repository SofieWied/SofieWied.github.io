{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Dependency Ratio under Different Retirement Age Scenarios (1950-2070)",
    "anchor": "start",
    "subtitle": "Source: Own calculations based on Destatis population projections",
    "fontSize": 22,
    "subtitleFontSize": 14,
    "color": "#333",
    "subtitleColor": "#333"
  },
  "width": 600,
  "height": 400,
  "background": "#faf8f3",
  "config": {
    "font": "Calibri",
    "legend": {
      "orient": "none",
      "legendX": 10,
      "legendY": 10,
      "labelFontSize": 12,
      "symbolSize": 150,
      "symbolStrokeWidth": 6
    }
  },
  "view": {
    "fill": "#faf8f3",
    "strokeOpacity": 0
  },
  "resolve": {
    "scale": {
      "x": "shared",
      "y": "shared"
    }
  },
  "params": [
    {
      "name": "scenarioSelect",
      "value": "Baseline (Retirement 65)",
      "bind": {
        "input": "select",
        "options": [
          "Baseline (Retirement 65)",
          "Retirement at 70",
          "Retirement at 75"
        ],
        "labels": [
          "Retirement Age 65",
          "Retirement Age 70",
          "Retirement Age 75"
        ],
        "name": "Scenario: "
      }
    }
  ],
  "data": {
    "url": "https://raw.githubusercontent.com/SofieWied/SofieWied.github.io/refs/heads/main/project_chart2b_ratio_scenarios.csv"
  },
  "transform": [
    {
      "filter": "datum.Scenario == scenarioSelect"
    },
    {
      "calculate": "toNumber(datum.year)",
      "as": "year_num"
    }
  ],
  "layer": [
    {
      "transform": [
        {
          "fold": [
            "Youth_Dependency_Ratio",
            "Old_Age_Dependency_Ratio"
          ],
          "as": ["Ratio_Type", "Value"]
        },
        {
          "calculate": "datum.Ratio_Type == 'Youth_Dependency_Ratio' ? 'Youth Dependency' : 'Old Age Dependency'",
          "as": "Ratio_Label"
        }
      ],
      "mark": {
        "type": "area",
        "opacity": 0.7
      },
      "encoding": {
        "x": {
          "field": "year_num",
          "type": "quantitative",
          "scale": {
            "domain": [1950, 2070],
            "nice": false
          },
          "axis": {
            "title": "Year",
            "titleColor": "#333",
            "labelColor": "#333",
            "grid": false,
            "format": "d"
          }
        },
        "y": {
          "field": "Value",
          "type": "quantitative",
          "stack": true,
          "scale": {
            "domain": [0, 100]
          },
          "axis": {
            "title": "Dependency Ratio (%)",
            "titleColor": "#333",
            "labelColor": "#333",
            "grid": true,
            "gridColor": "#e0e0e0",
            "gridOpacity": 0.5
          }
        },
        "color": {
          "field": "Ratio_Type",
          "type": "nominal",
          "scale": {
            "domain": [
              "Youth_Dependency_Ratio",
              "Old_Age_Dependency_Ratio",
              "Total_Dependency_Ratio"
            ],
            "range": ["#A6CEE3", "#1F78B4", "#9467BD"]
          },
          "legend": {
            "title": null,
            "labelExpr": "datum.value == 'Youth_Dependency_Ratio' ? 'Youth Dependency' : datum.value == 'Old_Age_Dependency_Ratio' ? 'Old Age Dependency' : 'Total Dependency'"
          }
        },
        "tooltip": [
          {
            "field": "year_num",
            "type": "quantitative",
            "title": "Year",
            "format": "d"
          },
          {
            "field": "Ratio_Label",
            "type": "nominal",
            "title": "Type"
          },
          {
            "field": "Value",
            "type": "quantitative",
            "title": "Ratio (%)",
            "format": ".1f"
          }
        ]
      }
    },
    {
      "mark": {
        "type": "line",
        "strokeWidth": 4
      },
      "encoding": {
        "x": {
          "field": "year_num",
          "type": "quantitative",
          "scale": {
            "domain": [1950, 2070],
            "nice": false
          }
        },
        "y": {
          "field": "Total_Dependency_Ratio",
          "type": "quantitative",
          "scale": {
            "domain": [0, 100]
          }
        },
        "color": {
          "datum": "Total_Dependency_Ratio",
          "type": "nominal",
          "legend": null
        },
        "tooltip": [
          {
            "field": "year_num",
            "type": "quantitative",
            "title": "Year",
            "format": "d"
          },
          {
            "datum": "Total Dependency",
            "title": "Type"
          },
          {
            "field": "Total_Dependency_Ratio",
            "type": "quantitative",
            "title": "Ratio (%)",
            "format": ".1f"
          }
        ]
      }
    },
    {
      "mark": {
        "type": "rule",
        "strokeWidth": 5,
        "strokeDash": [5, 5],
        "color": "#C96763"
      },
      "encoding": {
        "x": {
          "datum": 2025,
          "type": "quantitative",
          "scale": {
            "domain": [1950, 2070],
            "nice": false
          }
        }
      }
    }
  ]
}